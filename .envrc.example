# direnv configuration â€” copy to .envrc and run `direnv allow` to enable.
#
# Review this file before enabling. It ONLY:
#   1. Loads secrets from .env (NETBOX_URL, NETBOX_TOKEN, etc.) into the shell
#   2. Creates a uv virtual environment if one does not exist
#   3. Syncs Python dependencies via `uv sync`
#
# Prerequisites: direnv (https://direnv.net) and uv (https://docs.astral.sh/uv/)

# Source .env file if it exists (contains secrets, not in git)
if [[ -f .env ]]; then
    log_status "Loading .env variables..."
    dotenv .env
fi

# Create and activate uv virtual environment
if command -v uv &> /dev/null; then
    # Create venv if it doesn't exist
    if [[ ! -d .venv ]]; then
        log_status "Creating virtual environment with uv..."
        uv venv .venv
    fi

    # Sync dependencies
    if [[ -f pyproject.toml ]]; then
        log_status "Syncing dependencies with uv..."
        uv sync --quiet --native-tls
    fi

    # Activate the virtual environment
    source .venv/bin/activate
else
    log_error "uv not found. Please install uv: https://docs.astral.sh/uv/"
fi
